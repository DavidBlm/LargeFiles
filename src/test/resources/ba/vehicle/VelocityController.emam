package ba.vehicle;

component VelocityController{
    ports in Q maxVelIn,
          in Q maxAccelIn,
          in Q deltaTimeIn,
          in B slowDownIn,
          in B resetVelIn;

    ports out Q curVelOut;

    implementation Math{
        static Q lastVel = 0;
        Q resVel;

        if resetVelIn
            lastVel = maxVelIn;
            resVel = maxVelIn;
        else
            Q deltaVel = maxAccelIn * deltaTimeIn;
            if slowDownIn
                resVel = lastVel - deltaVel;
            else
                resVel = lastVel + deltaVel;
            end
        end

        if resVel < 0
            resVel = 0;
        elseif resVel > maxVelIn
            resVel = maxVelIn;
        end
        curVelOut = resVel;
        lastVel = curVelOut;
    }
}